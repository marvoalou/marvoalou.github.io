<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>CS61A-note | Zxman</title><meta name="author" content="zxman"><meta name="copyright" content="zxman"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="高阶函数抽象本质是更上一级的抽象函数可以作为函数的参数,不能作为控制结构的关键在于抽象出概念函数所在的帧是直接父级   eg1: 12345678910111213141516171819def average(x, y):    return (x + y)&#x2F;2def improve(update, close, guess&#x3D;1):    while not close(guess):">
<meta property="og:type" content="article">
<meta property="og:title" content="CS61A-note">
<meta property="og:url" content="http://marvoalou.github.io/2024/02/24/CS61A-note/index.html">
<meta property="og:site_name" content="Zxman">
<meta property="og:description" content="高阶函数抽象本质是更上一级的抽象函数可以作为函数的参数,不能作为控制结构的关键在于抽象出概念函数所在的帧是直接父级   eg1: 12345678910111213141516171819def average(x, y):    return (x + y)&#x2F;2def improve(update, close, guess&#x3D;1):    while not close(guess):">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://marvoalou.github.io/img/xuezhixia.jpg">
<meta property="article:published_time" content="2024-02-24T09:12:39.000Z">
<meta property="article:modified_time" content="2024-02-24T09:13:46.106Z">
<meta property="article:author" content="zxman">
<meta property="article:tag" content="zxman">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://marvoalou.github.io/img/xuezhixia.jpg"><link rel="shortcut icon" href="/img/logo1.jpg"><link rel="canonical" href="http://marvoalou.github.io/2024/02/24/CS61A-note/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.12.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.32/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体中文","cht_to_chs":"你已切换为简体中文","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'CS61A-note',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-02-24 17:13:46'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/bg.css"><meta name="generator" content="Hexo 7.1.1"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (false) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/xuezhixia.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">8</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/index1.png')"><nav id="nav"><span id="blog-info"><a href="/" title="Zxman"><img class="site-icon" src="https://tse3-mm.cn.bing.net/th/id/OIP-C.VIiHnqqe9l-MB2_03iub1QHaHa?rs=1&amp;pid=ImgDetMain"/><span class="site-name">Zxman</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">CS61A-note</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-02-24T09:12:39.000Z" title="发表于 2024-02-24 17:12:39">2024-02-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-02-24T09:13:46.106Z" title="更新于 2024-02-24 17:13:46">2024-02-24</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="CS61A-note"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h2><h3 id="抽象"><a href="#抽象" class="headerlink" title="抽象"></a>抽象</h3><p>本质是更上一级的抽象<br>函数可以作为函数的参数,不能作为控制结构的<br>关键在于抽象出概念<br>函数所在的帧是直接父级  </p>
<p>eg1:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">average</span>(<span class="params">x, y</span>):</span><br><span class="line">    <span class="keyword">return</span> (x + y)/<span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">improve</span>(<span class="params">update, close, guess=<span class="number">1</span></span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> close(guess):</span><br><span class="line">        guess = update(guess)</span><br><span class="line">    <span class="keyword">return</span> guess</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">approx_eq</span>(<span class="params">x, y, tolerance=<span class="number">1e-3</span></span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">abs</span>(x - y) &lt; tolerance</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sqrt</span>(<span class="params">a</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sqrt_update</span>(<span class="params">x</span>):</span><br><span class="line">        <span class="keyword">return</span> average(x, a/x)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sqrt_close</span>(<span class="params">x</span>):</span><br><span class="line">        <span class="keyword">return</span> approx_eq(x * x, a)</span><br><span class="line">    <span class="keyword">return</span> improve(sqrt_update, sqrt_close)</span><br><span class="line"></span><br><span class="line">result = sqrt(<span class="number">256</span>)</span><br></pre></td></tr></table></figure>
<p>函数设计是一种思想，对问题从顶层到底层一步步抽象，，数学中将特殊问题一般化，而模板就是面向一般化的“步骤本身”</p>
<p>为了能使用抽象模板，一个技巧是以函数为参数可以得到需求形式的函数<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">compose1</span>(<span class="params">f, g</span>):</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">h</span>(<span class="params">x</span>):</span><br><span class="line">            <span class="keyword">return</span> f(g(x))</span><br><span class="line">        <span class="keyword">return</span> h</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>add_one_and_square = compose1(square, successor)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>add_one_and_square(<span class="number">12</span>)</span><br><span class="line"><span class="number">169</span></span><br></pre></td></tr></table></figure></p>
<h3 id="lamda"><a href="#lamda" class="headerlink" title="lamda"></a>lamda</h3><p>也可以使用lamda</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">compose1</span>(<span class="params">f,g</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">lambda</span> x: f(g(x))</span><br></pre></td></tr></table></figure>
<p>或<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>compose1 = <span class="keyword">lambda</span> f,g: <span class="keyword">lambda</span> x: f(g(x))</span><br></pre></td></tr></table></figure></p>
<p>lamda：<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">     <span class="keyword">lambda</span>            x            :          f(g(x))</span><br><span class="line"><span class="string">&quot;A function that    takes x    and returns     f(g(x))&quot;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="装饰器"><a href="#装饰器" class="headerlink" title="装饰器"></a>装饰器</h3><p>思想：等到给参数的时候才进行进一步调用，所以要用到高阶</p>
<p>用法：<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">trace1</span>(<span class="params">fn</span>):</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">wrapped</span>(<span class="params">x</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;-&gt; &#x27;</span>, fn, <span class="string">&#x27;(&#x27;</span>, x, <span class="string">&#x27;)&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> fn(x)</span><br><span class="line">        <span class="keyword">return</span> wrapped</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>@trace1</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">triple</span>(<span class="params">x</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">3</span> * x</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>triple(<span class="number">12</span>)</span><br><span class="line">-&gt;  &lt;function triple at <span class="number">0x102a39848</span>&gt; ( <span class="number">12</span> )</span><br><span class="line"><span class="number">36</span></span><br></pre></td></tr></table></figure></p>
<p>本质：<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">triple</span>(<span class="params">x</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">3</span> * x</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>triple = trace1(triple)</span><br></pre></td></tr></table></figure></p>
<p>装饰器接受一个函数为参数，返回的本质上也是这个函数</p>
<p>使用装饰函数，以目标函数作为参数，进行指定的<strong>处理</strong>(装饰)</p>
<p>可以多重装饰，只要返回值是原函数，装饰只是增加副作用<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">count</span>(<span class="params">f</span>):           <span class="comment">#这种格式的，经过count和memo的修饰，就会有父帧的call_count属性，以及一些和属性相关的功能，反正不修改函数本身</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">counted</span>(<span class="params">n</span>):</span><br><span class="line">            counted.call_count += <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> f(n)</span><br><span class="line">        counted.call_count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> counted</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">memo</span>(<span class="params">f</span>):</span><br><span class="line">        cache = &#123;&#125;</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">memorized</span>(<span class="params">n</span>):</span><br><span class="line">            <span class="keyword">if</span> n <span class="keyword">not</span> <span class="keyword">in</span> cache:</span><br><span class="line">                cache[n] = f(n)</span><br><span class="line">            <span class="keyword">return</span> cache[n]</span><br><span class="line">        <span class="keyword">return</span> memorized</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>counted_fib = count(fib)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fib =memo(count_fib)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fib(<span class="number">19</span>)</span><br><span class="line"><span class="number">4181</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>counted_fib.call_count</span><br><span class="line"><span class="number">20</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fib(<span class="number">34</span>)</span><br><span class="line"><span class="number">5702887</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>counted_fib.call_count</span><br><span class="line"><span class="number">35</span></span><br></pre></td></tr></table></figure></p>
<p>函数式编程思想：<br>所谓函数就是接受对象作为参数，并返回对象的一个盒子，这样看来函数就是一种自己定义的数学运算符，即像是自己定义了一种新的计算，也像是一个数学公式<br>对象可以是类、基本数据、函数，而且函数本身也可以作为对象，这就意味着最小操作类型可以看作是对象，而所谓的类、函数等也不过是一种新的数据类型组织方式<br>所以编写程序的过程就是自己构造一个数学公式来产生目标输出的功能<br>所以关键是，要知道要接受一个怎么样的对象，返回一个什么样功能的对象  </p>
<p>再例如Web中：<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">PlatformAuthenticated</span>(<span class="params">auth_level</span>):      <span class="comment">#将验证handler的函数作为修饰器，通过类设置一些外部属性，调用get方法时自动调用call，自动验证</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">StrictPlatformAuth</span>:</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, handler</span>):</span><br><span class="line">            self.handler = handler</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, request, response</span>):</span><br><span class="line">            auth = request.authorization(auth_level)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> auth <span class="keyword">or</span> <span class="keyword">not</span> check_auth(auth.username, auth.password):</span><br><span class="line">                <span class="keyword">raise</span> Exception(<span class="string">&quot;BlahBlahBlah&quot;</span>)</span><br><span class="line">            self.handler(request, response)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> StrictPlatformAuth</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WebHandler</span>:</span><br><span class="line"><span class="meta">    @PlatformAuthenticated(<span class="params">ADMIN</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request, response</span>):</span><br><span class="line">        do_something()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RobotWebHandler</span>:</span><br><span class="line"><span class="meta">    @PlatformAuthenticated(<span class="params">ROBOT</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request, response</span>):</span><br><span class="line">        do_something()</span><br></pre></td></tr></table></figure></p>
<h3 id="柯里化"><a href="#柯里化" class="headerlink" title="柯里化"></a>柯里化</h3><p>多参数函数和指定参数函数之间的转换：<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">curry2</span>(<span class="params">f</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;返回给定的双参数函数的柯里化版本&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">g</span>(<span class="params">x</span>):</span><br><span class="line">            <span class="keyword">def</span> <span class="title function_">h</span>(<span class="params">y</span>):</span><br><span class="line">                <span class="keyword">return</span> f(x, y)</span><br><span class="line">            <span class="keyword">return</span> h</span><br><span class="line">        <span class="keyword">return</span> g</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">uncurry2</span>(<span class="params">g</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;返回给定的柯里化函数的双参数版本&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">x, y</span>):</span><br><span class="line">            <span class="keyword">return</span> g(x)(y)</span><br><span class="line">        <span class="keyword">return</span> f</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pow_curried = curry2(<span class="built_in">pow</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pow_curried(<span class="number">2</span>)(<span class="number">5</span>)</span><br><span class="line"><span class="number">32</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>map_to_range(<span class="number">0</span>, <span class="number">10</span>, pow_curried(<span class="number">2</span>))</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="number">16</span></span><br><span class="line"><span class="number">32</span></span><br><span class="line"><span class="number">64</span></span><br><span class="line"><span class="number">128</span></span><br><span class="line"><span class="number">256</span></span><br><span class="line"><span class="number">512</span></span><br></pre></td></tr></table></figure></p>
<h3 id="递归"><a href="#递归" class="headerlink" title="递归"></a>递归</h3><p>递归思路：自顶向下，只关心下一层，不关心全部(return)<br>只有最后一层才有细节(if n==1)</p>
<p>要清楚<strong>迭代对象</strong>和<strong>迭代关系</strong><br>以函数为整体看待<br>对应数学归纳法，归纳的时候考虑的是过程中的一般情况以及临界条件，不应该自动带入考虑程序怎么跑<br>只要是序列间有关系的问题都可以用递归解决</p>
<p>hw03的count_change</p>
<p>hw04的balance,归纳法：假设这个函数已经成立，可以用这个函数本身来递推的实现功能，再验证边界成立<br>    preorder: 列表本身可以被迭代，所以可以写二重循环</p>
<h2 id="数据抽象"><a href="#数据抽象" class="headerlink" title="数据抽象"></a>数据抽象</h2><h3 id="序列"><a href="#序列" class="headerlink" title="序列"></a>序列</h3><p>序列解构：将序列元素的子序列元素映射到指定的name上</p>
<p>range是序列</p>
<p>有.count和.index行为<br>count行为匹配的是非重叠的字符串</p>
<p>字符串本质也是一种序列，换行符也会被认为是字符串元素<br>字符串的in匹配的是字符串</p>
<p>接口：使用map，reduce，filter来实现对数据的一系列组件操作，<br>也可以使用生成器表达式：<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">acronym</span>(<span class="params">name</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">tuple</span>(w[<span class="number">0</span>] <span class="keyword">for</span> w <span class="keyword">in</span> name.split() <span class="keyword">if</span> iscap(w))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">sum_even_fibs</span>(<span class="params">n</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(fib(k) <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, n+<span class="number">1</span>) <span class="keyword">if</span> fib(k) % <span class="number">2</span> == <span class="number">0</span>)</span><br></pre></td></tr></table></figure></p>
<p>使用构造器和选择器对抽象数据进行操作</p>
<h2 id="2-4-可变数据"><a href="#2-4-可变数据" class="headerlink" title="2.4 可变数据"></a>2.4 可变数据</h2><p>对象是一种数据类型，其中包含函数(操作数据的行为)以及数据，不仅是值，也是一个过程<br><strong>python万物皆对象</strong></p>
<h4 id="为什么要设计类？"><a href="#为什么要设计类？" class="headerlink" title="为什么要设计类？"></a>为什么要设计类？</h4><p>将数据和行为为基本元素抽象成一个新的数据类型，这种数据类型更加真实地映射了现实世界的对象，从功能上看更便于实现过程和行为的构建，从结构上看提供了强大的数据和行为之间的交互和传递能力(继承，多态)，以及极大地方便了对数据的处理和对行为的调用</p>
<h3 id="理解抽象"><a href="#理解抽象" class="headerlink" title="理解抽象"></a>理解抽象</h3><p>抽象的最终目的是产生更加通用的模板来简化操作，更通用、更简单地实现更多的任务<br>抽象必然是一层一层的，从计算机硬件电路到硬件模块的封装，从硬件到终端的交互，从基本数据类型到复合数据类型(OOP)，从符合数据类型到一系列数据和行为构成的集合体(包和库)，再到软件的实现<br>实现功能的抽象模块之间应该是尽量独立的，不互相影响的，否则负责的交互关系会使底层出现问题的时候产生不可预测的对高级抽象的影响，以及加大了抽象修改的难度<br>所以从底层一步步向上理解学习吧，才能有更扎实的基础</p>
<h3 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h3><p>使用变异(mutating)操作会修改可变对象<br>对于可变对象，关联名称不是创建副本，而是绑定到同一个对象上：<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>chinese = [<span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;pear&#x27;</span>, <span class="string">&#x27;monkey&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>suits = chinese</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>suits.pop()</span><br><span class="line"><span class="string">&#x27;monkey&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>chinese</span><br><span class="line">[<span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;pear&#x27;</span>]</span><br></pre></td></tr></table></figure></p>
<p>创建副本的方法：<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>nest = <span class="built_in">list</span>(suits)</span><br></pre></td></tr></table></figure></p>
<p>判断两个对象是否是同一个，用<code>is</code>或<code>is not</code>，判读是否相等用<code>==</code></p>
<h3 id="元组"><a href="#元组" class="headerlink" title="元组"></a>元组</h3><p>不可变对象</p>
<h3 id="字典"><a href="#字典" class="headerlink" title="字典"></a>字典</h3><p>描述性检索的数据抽象</p>
<p>dict()可以将键值对列表转化为字典：<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">dict</span>([(<span class="number">3</span>, <span class="number">9</span>), (<span class="number">4</span>, <span class="number">16</span>), (<span class="number">5</span>, <span class="number">25</span>)])</span><br><span class="line">&#123;<span class="number">3</span>: <span class="number">9</span>, <span class="number">4</span>: <span class="number">16</span>, <span class="number">5</span>: <span class="number">25</span>&#125;</span><br></pre></td></tr></table></figure></p>
<p>可以用推导式语法创建：<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>&#123;x: x*x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>,<span class="number">6</span>)&#125;</span><br><span class="line">&#123;<span class="number">3</span>: <span class="number">9</span>, <span class="number">4</span>: <span class="number">16</span>, <span class="number">5</span>: <span class="number">25</span>&#125;</span><br></pre></td></tr></table></figure></p>
<p>方法：</p>
<ul>
<li>get(key,default_value)    return the value if key exist or default value</li>
<li>items()                   return key and value that is iterable</li>
<li>values()                  return iterable values</li>
<li>keys()                    …………….keys</li>
</ul>
<h3 id="局部状态"><a href="#局部状态" class="headerlink" title="局部状态"></a>局部状态</h3><p>对函数可变数据的构建用的是nonlocal —— 用于将数据置为非局部状态<br><strong>python限制一个名称对应的实例必须绑定在同一个局部帧中，所以不存在两个帧使用同一个名称的情况</strong><br>查找非局部帧的值不需要非局部语句，修改需要<br>python预处理名称来限制绑定的帧只能在局部帧，所以不允许提前引用变量  </p>
<h4 id="好处"><a href="#好处" class="headerlink" title="好处"></a>好处</h4><p>非局部赋值实际上是将balance与with_draw单独绑定，便于各个函数独立分治自己的局部状态<br>创建一个实例就对应创建一个绑定<br>所以引出了一个问题：<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>   <span class="keyword">def</span> <span class="title function_">make_withdraw</span>(<span class="params">balance</span>):</span><br><span class="line"><span class="number">2</span>	    <span class="keyword">def</span> <span class="title function_">withdraw</span>(<span class="params">amount</span>):</span><br><span class="line"><span class="number">3</span>	        <span class="keyword">nonlocal</span> balance</span><br><span class="line"><span class="number">4</span>	        <span class="keyword">if</span> amount &gt; balance:</span><br><span class="line"><span class="number">5</span>	            <span class="keyword">return</span> <span class="string">&#x27;Insufficient funds&#x27;</span></span><br><span class="line"><span class="number">6</span>	        balance = balance - amount</span><br><span class="line"><span class="number">7</span>	        <span class="keyword">return</span> balance</span><br><span class="line"><span class="number">8</span>	    <span class="keyword">return</span> withdraw</span><br><span class="line"><span class="number">9</span>	</span><br><span class="line"><span class="number">10</span>	wd = make_withdraw(<span class="number">12</span>)</span><br><span class="line"><span class="number">11</span>	wd2 = wd</span><br><span class="line"><span class="number">12</span>	wd2(<span class="number">1</span>)</span><br><span class="line"><span class="number">13</span>	wd(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><br>两个相同的名称连接到一个绑定上，所处的帧并没有改变，<strong>只有函数调用才会创建新帧</strong></p>
<h4 id="实现列表和字典结构"><a href="#实现列表和字典结构" class="headerlink" title="实现列表和字典结构"></a>实现列表和字典结构</h4><p>使用非局部状态函数可以实现可变数据类型，因为非局部帧相当于提供使数据可变的能力，既不帧提供操作数据的方法<br>用函数来作为可变数据结构<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">mutable_link</span>():</span><br><span class="line">        <span class="string">&quot;&quot;&quot;返回一个可变链表的函数&quot;&quot;&quot;</span></span><br><span class="line">        contents = empty</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">dispatch</span>(<span class="params">message, value=<span class="literal">None</span></span>):</span><br><span class="line">            <span class="keyword">nonlocal</span> contents</span><br><span class="line">            <span class="keyword">if</span> message == <span class="string">&#x27;len&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> len_link(contents)</span><br><span class="line">            <span class="keyword">elif</span> message == <span class="string">&#x27;getitem&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> getitem_link(contents, value)</span><br><span class="line">            <span class="keyword">elif</span> message == <span class="string">&#x27;push_first&#x27;</span>:</span><br><span class="line">                contents = link(value, contents)</span><br><span class="line">            <span class="keyword">elif</span> message == <span class="string">&#x27;pop_first&#x27;</span>:</span><br><span class="line">                f = first(contents)</span><br><span class="line">                contents = rest(contents)</span><br><span class="line">                <span class="keyword">return</span> f</span><br><span class="line">            <span class="keyword">elif</span> message == <span class="string">&#x27;str&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> join_link(contents, <span class="string">&quot;, &quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> dispatch</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">to_mutable_link</span>(<span class="params">source</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;返回一个与原列表相同内容的函数列表&quot;&quot;&quot;</span></span><br><span class="line">        s = mutable_link()</span><br><span class="line">        <span class="keyword">for</span> element <span class="keyword">in</span> <span class="built_in">reversed</span>(source):</span><br><span class="line">            s(<span class="string">&#x27;push_first&#x27;</span>, element)</span><br><span class="line">        <span class="keyword">return</span> s</span><br></pre></td></tr></table></figure><br>可以用两种方法来实现对数据类型的变异操作：</p>
<ul>
<li>将方法放到一个局部帧中</li>
<li>将方法放到不同局部帧中，提供一个消息接口来调用(消息传递)</li>
</ul>
<p>消息传递的实现可以模拟一个send_message的过程</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">dictionary</span>():</span><br><span class="line">        <span class="string">&quot;&quot;&quot;返回一个字典的函数实现&quot;&quot;&quot;</span></span><br><span class="line">        records = []</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">getitem</span>(<span class="params">key</span>):</span><br><span class="line">            matches = [r <span class="keyword">for</span> r <span class="keyword">in</span> records <span class="keyword">if</span> r[<span class="number">0</span>] == key]</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(matches) == <span class="number">1</span>:</span><br><span class="line">                key, value = matches[<span class="number">0</span>]</span><br><span class="line">                <span class="keyword">return</span> value</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">setitem</span>(<span class="params">key, value</span>):</span><br><span class="line">            <span class="keyword">nonlocal</span> records</span><br><span class="line">            non_matches = [r <span class="keyword">for</span> r <span class="keyword">in</span> records <span class="keyword">if</span> r[<span class="number">0</span>] != key]</span><br><span class="line">            records = non_matches + [[key, value]]</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">dispatch</span>(<span class="params">message, key=<span class="literal">None</span>, value=<span class="literal">None</span></span>):</span><br><span class="line">            <span class="keyword">if</span> message == <span class="string">&#x27;getitem&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> getitem(key)</span><br><span class="line">            <span class="keyword">elif</span> message == <span class="string">&#x27;setitem&#x27;</span>:</span><br><span class="line">                setitem(key, value)</span><br><span class="line">        <span class="keyword">return</span> dispatch</span><br></pre></td></tr></table></figure>
<h3 id="声明式编程实践：约束传递-Propagating-Constraints"><a href="#声明式编程实践：约束传递-Propagating-Constraints" class="headerlink" title="声明式编程实践：约束传递(Propagating Constraints)"></a>声明式编程实践：约束传递(Propagating Constraints)</h3><p>声明式编程的特性是声明要解决的问题的结构<br>编程中的表达式的计算都是单项的，要实现多项的解方程求值要用变量关系的约束器(Constrainter)和提醒其他约束器的连接器(connector)构成网络<br>使用消息传递以及对消息进行响应的数据结构(类)来构建网络</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>connector [<span class="string">&#x27;set_val&#x27;</span>](source, value)  <span class="string">&quot;&quot;&quot;表示 source 在请求连接器将当前值设为 value&quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>connector [<span class="string">&#x27;has_val&#x27;</span>]()  <span class="string">&quot;&quot;&quot;返回连接器是否已经具有值&quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>connector [<span class="string">&#x27;val&#x27;</span>]  <span class="string">&quot;&quot;&quot;是连接器的当前值&quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>connector [<span class="string">&#x27;forget&#x27;</span>](source)  <span class="string">&quot;&quot;&quot;告诉连接器 source 请求遗忘它的值&quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>connector [<span class="string">&#x27;connect&#x27;</span>](source)  <span class="string">&quot;&quot;&quot;告诉连接器参与新的约束，即 source&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>constraint[<span class="string">&#x27;new_val&#x27;</span>]()  <span class="string">&quot;&quot;&quot;表示与约束相连的某个连接器具有新的值。&quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>constraint[<span class="string">&#x27;forget&#x27;</span>]()  <span class="string">&quot;&quot;&quot;表示与约束相连的某个连接器遗忘了值。&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">converter</span>(<span class="params">c, f</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;用约束条件连接 c 到 f ，将摄氏度转换为华氏度.&quot;&quot;&quot;</span></span><br><span class="line">        u, v, w, x, y = [connector() <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)]</span><br><span class="line">        multiplier(c, w, u)</span><br><span class="line">        multiplier(v, x, u)</span><br><span class="line">        adder(v, y, f)</span><br><span class="line">        constant(w, <span class="number">9</span>)</span><br><span class="line">        constant(x, <span class="number">5</span>)</span><br><span class="line">        constant(y, <span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> operator <span class="keyword">import</span> add, sub</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">adder</span>(<span class="params">a, b, c</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;约束a+b=c&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> make_ternary_constraint(a, b, c, add, sub, sub)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">constant</span>(<span class="params">connector, value</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;常量赋值.&quot;&quot;&quot;</span></span><br><span class="line">        constraint = &#123;&#125;</span><br><span class="line">        connector[<span class="string">&#x27;set_val&#x27;</span>](constraint, value)</span><br><span class="line">        <span class="keyword">return</span> constraint</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">make_ternary_constraint</span>(<span class="params">a, b, c, ab, ca, cb</span>):       <span class="comment">#不存储连接的连接器，只提供功能</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;约束ab(a,b)=c，ca(c,a)=b，cb(c,b)=a。&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">new_value</span>():</span><br><span class="line">            av, bv, cv = [connector[<span class="string">&#x27;has_val&#x27;</span>]() <span class="keyword">for</span> connector <span class="keyword">in</span> (a, b, c)]</span><br><span class="line">            <span class="keyword">if</span> av <span class="keyword">and</span> bv:</span><br><span class="line">                c[<span class="string">&#x27;set_val&#x27;</span>](constraint, ab(a[<span class="string">&#x27;val&#x27;</span>], b[<span class="string">&#x27;val&#x27;</span>]))</span><br><span class="line">            <span class="keyword">elif</span> av <span class="keyword">and</span> cv:</span><br><span class="line">                b[<span class="string">&#x27;set_val&#x27;</span>](constraint, ca(c[<span class="string">&#x27;val&#x27;</span>], a[<span class="string">&#x27;val&#x27;</span>]))</span><br><span class="line">            <span class="keyword">elif</span> bv <span class="keyword">and</span> cv:</span><br><span class="line">                a[<span class="string">&#x27;set_val&#x27;</span>](constraint, cb(c[<span class="string">&#x27;val&#x27;</span>], b[<span class="string">&#x27;val&#x27;</span>]))</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">forget_value</span>():</span><br><span class="line">            <span class="keyword">for</span> connector <span class="keyword">in</span> (a, b, c):</span><br><span class="line">                connector[<span class="string">&#x27;forget&#x27;</span>](constraint)</span><br><span class="line">        constraint = &#123;<span class="string">&#x27;new_val&#x27;</span>: new_value, <span class="string">&#x27;forget&#x27;</span>: forget_value&#125;</span><br><span class="line">        <span class="keyword">for</span> connector <span class="keyword">in</span> (a, b, c):</span><br><span class="line">            connector[<span class="string">&#x27;connect&#x27;</span>](constraint)</span><br><span class="line">        <span class="keyword">return</span> constraint</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">connector</span>(<span class="params">name=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;限制条件之间的连接器.&quot;&quot;&quot;</span></span><br><span class="line">        informant = <span class="literal">None</span></span><br><span class="line">        constraints = []</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">set_value</span>(<span class="params">source, value</span>):</span><br><span class="line">            <span class="keyword">nonlocal</span> informant</span><br><span class="line">            val = connector[<span class="string">&#x27;val&#x27;</span>]</span><br><span class="line">            <span class="keyword">if</span> val <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                informant, connector[<span class="string">&#x27;val&#x27;</span>] = source, value</span><br><span class="line">                <span class="keyword">if</span> name <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                    <span class="built_in">print</span>(name, <span class="string">&#x27;=&#x27;</span>, value)</span><br><span class="line">                inform_all_except(source, <span class="string">&#x27;new_val&#x27;</span>, constraints)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> val != value:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&#x27;Contradiction detected:&#x27;</span>, val, <span class="string">&#x27;vs&#x27;</span>, value)</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">forget_value</span>(<span class="params">source</span>):</span><br><span class="line">            <span class="keyword">nonlocal</span> informant</span><br><span class="line">            <span class="keyword">if</span> informant == source:</span><br><span class="line">                informant, connector[<span class="string">&#x27;val&#x27;</span>] = <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line">                <span class="keyword">if</span> name <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                    <span class="built_in">print</span>(name, <span class="string">&#x27;is forgotten&#x27;</span>)</span><br><span class="line">                inform_all_except(source, <span class="string">&#x27;forget&#x27;</span>, constraints)</span><br><span class="line">        connector = &#123;<span class="string">&#x27;val&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line">                     <span class="string">&#x27;set_val&#x27;</span>: set_value,</span><br><span class="line">                     <span class="string">&#x27;forget&#x27;</span>: forget_value,</span><br><span class="line">                     <span class="string">&#x27;has_val&#x27;</span>: <span class="keyword">lambda</span>: connector[<span class="string">&#x27;val&#x27;</span>] <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>,</span><br><span class="line">                     <span class="string">&#x27;connect&#x27;</span>: <span class="keyword">lambda</span> source: constraints.append(source)&#125;</span><br><span class="line">        <span class="keyword">return</span> connector</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">inform_all_except</span>(<span class="params">source, message, constraints</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;告知信息除了source外的所有约束条件，。&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> constraints:</span><br><span class="line">            <span class="keyword">if</span> c != source:</span><br><span class="line">                c[message]()</span><br></pre></td></tr></table></figure>
<h2 id="OOP"><a href="#OOP" class="headerlink" title="OOP"></a>OOP</h2><p>类的构造器：<code>__init__</code><br><code>self</code>绑定对象，调用时实例会绑定到self中<br>赋值将对象绑定到新名称不会创建新对象:<br><code>c = a</code><br>作为类的属性，方法只是一个函数，但作为实例的属性，它是一个绑定方法：<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(Account.deposit)</span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">&#x27;Function&#x27;</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(spock_account.deposit)</span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">&#x27;method&#x27;</span>&gt;</span><br></pre></td></tr></table></figure></p>
<p>我们可以通过两种方式调用 deposit ：作为函数和作为绑定方法。在前一种情况下，我们必须显式地为 self 参数提供一个参数。在后一种情况下， self 参数会自动绑定。<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Account.deposit(spock_account, <span class="number">1001</span>)	<span class="comment"># 函数 deposit 接受两个参数</span></span><br><span class="line"><span class="number">1011</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>spock_account.deposit(<span class="number">1000</span>) 			<span class="comment"># 方法 deposit 接受一个参数</span></span><br><span class="line"><span class="number">2011</span></span><br></pre></td></tr></table></figure></p>
<p>如果属性名称以下划线开头，则只能在类中本地访问，不能被用户访问</p>
<p><strong>类属性</strong>是所有实例共享的静态变量</p>
<p>对象的点表达式，如果是实例，存在则调用，不存在则创建，但是不会访问类属性，只有对类的调点表达式才会修改类属性<br>同名时，本地的实例属性是优先于类属性的</p>
<p>baseclass, superclass, parentclass<br>subclass, childclass</p>
<p>接受参数作为父类，重写属性或者方法，注意父类中对实例属性的调用最好都用self.attr，方便作继承</p>
<p>尽量不要使用Account.method，使用实例的方法更具普遍性</p>
<p><strong>重写</strong>：方法可以重写，注意最后好使用self.attribution来在类中定义属性或方法，因为在该类的子类中继承此方法，要使用的是子类的新值</p>
<p><strong>多继承</strong>：<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">class</span> <span class="title class_">AsSeenOnTVAccount</span>(CheckingAccount, SavingsAccount):</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, account_holder</span>):</span><br><span class="line">            self.holder = account_holder</span><br><span class="line">            self.balance = <span class="number">1</span>           <span class="comment"># 赠送的 1 $!</span></span><br></pre></td></tr></table></figure><br>对于多继承，调用不同类的同一个名称的方法时，检索顺序为从左到右，从子到基<br>查看解析对于类和属性的查询顺序：<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>[c.__name__ <span class="keyword">for</span> c <span class="keyword">in</span> AsSeenOnTVAccount.mro()]</span><br><span class="line">[<span class="string">&#x27;AsSeenOnTVAccount&#x27;</span>, <span class="string">&#x27;CheckingAccount&#x27;</span>, <span class="string">&#x27;SavingsAccount&#x27;</span>, <span class="string">&#x27;Account&#x27;</span>, <span class="string">&#x27;object&#x27;</span>]</span><br></pre></td></tr></table></figure></p>
<h3 id="使用函数来实现类"><a href="#使用函数来实现类" class="headerlink" title="使用函数来实现类"></a>使用函数来实现类</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">make_instance</span>(<span class="params">cls</span>):</span><br><span class="line">		<span class="string">&quot;&quot;&quot;Return a new object instance, which is a dispatch dictionary.&quot;&quot;&quot;</span></span><br><span class="line">		<span class="keyword">def</span> <span class="title function_">get_value</span>(<span class="params">name</span>):</span><br><span class="line">			<span class="keyword">if</span> name <span class="keyword">in</span> attributes:</span><br><span class="line">				<span class="keyword">return</span> attributes[name]</span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				value = cls[<span class="string">&#x27;get&#x27;</span>](name)</span><br><span class="line">				<span class="keyword">return</span> bind_method(value, instance)</span><br><span class="line">		<span class="keyword">def</span> <span class="title function_">set_value</span>(<span class="params">name, value</span>):</span><br><span class="line">			attributes[name] = value</span><br><span class="line">		attributes = &#123;&#125;</span><br><span class="line">		instance = &#123;<span class="string">&#x27;get&#x27;</span>: get_value, <span class="string">&#x27;set&#x27;</span>: set_value&#125;</span><br><span class="line">		<span class="keyword">return</span> instance</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">bind_method</span>(<span class="params">value, instance</span>):</span><br><span class="line">		<span class="string">&quot;&quot;&quot;Return a bound method if is callable, or value otherwise.&quot;&quot;&quot;</span></span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">callable</span>(value):</span><br><span class="line">			<span class="keyword">def</span> <span class="title function_">method</span>(<span class="params">*args</span>):</span><br><span class="line">				<span class="keyword">return</span> value(instance, *args)</span><br><span class="line">			<span class="keyword">return</span> method</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			<span class="keyword">return</span> value</span><br></pre></td></tr></table></figure>
<p>使用响应消息的调度字典来实现，如果获取到的name在attribute中找不到，则进入bind_method来寻找以及绑定类和方法，找到了是函数的话，返回使用alue的函数，并且将instance作为self</p>
<h3 id="专用方法"><a href="#专用方法" class="headerlink" title="专用方法"></a>专用方法</h3><ul>
<li><code>__repr__</code>在使用交互环境时自动调用  </li>
<li><code>__str__</code>在打印时自动调用  </li>
<li><code>__bool__</code>构造，可以判断逻辑时自动调用  </li>
<li><code>__len__</code>长度，使用len()时调用  </li>
<li><code>__getitem__</code>，获取元素时调用  </li>
<li><code>__call__</code>可以使类可以像高阶函数一样被传播调用  <figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">class</span> <span class="title class_">Adder</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">		<span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, n</span>):</span><br><span class="line">			self.n = n</span><br><span class="line">		<span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, k</span>):</span><br><span class="line">			<span class="keyword">return</span> self.n + k</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>add_three_obj = Adder(<span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>add_three_obj(<span class="number">4</span>)</span><br><span class="line"><span class="number">7</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="多重表示"><a href="#多重表示" class="headerlink" title="多重表示"></a>多重表示</h3><p>接口是一组共享的属性名称，以及对它们的行为的规范<br>从最高层抽象向下实现：数值类型——拥有的操作——具体属性定义<br>Complex实现了接口，保证了具体方法的属性的一致性，达成了命名规范<br>@property修饰符可以将函数变为无参数，直接当属性值使用<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">class</span> <span class="title class_">Number</span>:</span><br><span class="line">		<span class="keyword">def</span> <span class="title function_">__add__</span>(<span class="params">self, other</span>):</span><br><span class="line">			<span class="keyword">return</span> self.add(other)</span><br><span class="line">		<span class="keyword">def</span> <span class="title function_">__mul__</span>(<span class="params">self, other</span>):</span><br><span class="line">			<span class="keyword">return</span> self.mul(other)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">class</span> <span class="title class_">Complex</span>(<span class="title class_ inherited__">Number</span>):</span><br><span class="line">		<span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self, other</span>):</span><br><span class="line">			<span class="keyword">return</span> ComplexRI(self.real + other.real, self.imag + other.imag)</span><br><span class="line">		<span class="keyword">def</span> <span class="title function_">mul</span>(<span class="params">self, other</span>):</span><br><span class="line">			magnitude = self.magnitude * other.magnitude</span><br><span class="line">			<span class="keyword">return</span> ComplexMA(magnitude, self.angle + other.angle)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> math <span class="keyword">import</span> atan2</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">class</span> <span class="title class_">ComplexRI</span>(<span class="title class_ inherited__">Complex</span>):</span><br><span class="line">		<span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, real, imag</span>):</span><br><span class="line">			self.real = real</span><br><span class="line">			self.imag = imag</span><br><span class="line"><span class="meta">		@property</span></span><br><span class="line">		<span class="keyword">def</span> <span class="title function_">magnitude</span>(<span class="params">self</span>):</span><br><span class="line">			<span class="keyword">return</span> (self.real ** <span class="number">2</span> + self.imag ** <span class="number">2</span>) ** <span class="number">0.5</span></span><br><span class="line"><span class="meta">		@property</span></span><br><span class="line">		<span class="keyword">def</span> <span class="title function_">angle</span>(<span class="params">self</span>):</span><br><span class="line">			<span class="keyword">return</span> atan2(self.imag, self.real)</span><br><span class="line">		<span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">			<span class="keyword">return</span> <span class="string">&#x27;ComplexRI(&#123;0:g&#125;, &#123;1:g&#125;)&#x27;</span>.<span class="built_in">format</span>(self.real, self.imag)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> math <span class="keyword">import</span> sin, cos, pi</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">class</span> <span class="title class_">ComplexMA</span>(<span class="title class_ inherited__">Complex</span>):</span><br><span class="line">		<span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, magnitude, angle</span>):</span><br><span class="line">			self.magnitude = magnitude</span><br><span class="line">			self.angle = angle</span><br><span class="line"><span class="meta">        	@property</span></span><br><span class="line">		<span class="keyword">def</span> <span class="title function_">real</span>(<span class="params">self</span>):</span><br><span class="line">			<span class="keyword">return</span> self.magnitude * cos(self.angle)</span><br><span class="line"><span class="meta">		@property</span></span><br><span class="line">		<span class="keyword">def</span> <span class="title function_">imag</span>(<span class="params">self</span>):</span><br><span class="line">			<span class="keyword">return</span> self.magnitude * sin(self.angle)</span><br><span class="line">		<span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">			<span class="keyword">return</span> <span class="string">&#x27;ComplexMA(&#123;0:g&#125;, &#123;1:g&#125; * pi)&#x27;</span>.<span class="built_in">format</span>(self.magnitude, self.angle/pi)</span><br></pre></td></tr></table></figure></p>
<p>优势：<br>类似complex的接口类是可以开发添加的</p>
<h3 id="泛型表示"><a href="#泛型表示" class="headerlink" title="泛型表示"></a>泛型表示</h3><h4 id="类型派发"><a href="#类型派发" class="headerlink" title="类型派发"></a>类型派发</h4><p>依据受到的参数的类型(类的种类)来派发响应，保证数据跨类型的时候仍然可以被正确地对待</p>
<p>内置的函数 isinstance 接受一个对象或一个类。如果对象的类是所给的类或者继承自所给的类，它会返回一个真值<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>c = ComplexRI(<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(c, ComplexRI)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(c, Complex)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(c, ComplexMA)</span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure></p>
<p>基于不同类型的接口类一个type_tag，来在进行操作的时候检查type_tag来进行类型派发<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">class</span> <span class="title class_">Number</span>:</span><br><span class="line">		<span class="keyword">def</span> <span class="title function_">__add__</span>(<span class="params">self, other</span>):</span><br><span class="line">			<span class="keyword">if</span> self.type_tag == other.type_tag:</span><br><span class="line">				<span class="keyword">return</span> self.add(other)</span><br><span class="line">			<span class="keyword">elif</span> (self.type_tag, other.type_tag) <span class="keyword">in</span> self.adders:</span><br><span class="line">				<span class="keyword">return</span> self.cross_apply(other, self.adders)</span><br><span class="line">		<span class="keyword">def</span> <span class="title function_">__mul__</span>(<span class="params">self, other</span>):</span><br><span class="line">			<span class="keyword">if</span> self.type_tag == other.type_tag:</span><br><span class="line">				<span class="keyword">return</span> self.mul(other)</span><br><span class="line">			<span class="keyword">elif</span> (self.type_tag, other.type_tag) <span class="keyword">in</span> self.multipliers:</span><br><span class="line">				<span class="keyword">return</span> self.cross_apply(other, self.multipliers)</span><br><span class="line">		<span class="keyword">def</span> <span class="title function_">cross_apply</span>(<span class="params">self, other, cross_fns</span>):</span><br><span class="line">			cross_fn = cross_fns[(self.type_tag, other.type_tag)]</span><br><span class="line">			<span class="keyword">return</span> cross_fn(self, other)</span><br><span class="line">		adders = &#123;(<span class="string">&quot;com&quot;</span>, <span class="string">&quot;rat&quot;</span>): add_complex_and_rational,</span><br><span class="line">					(<span class="string">&quot;rat&quot;</span>, <span class="string">&quot;com&quot;</span>): add_rational_and_complex&#125;</span><br><span class="line">		multipliers = &#123;(<span class="string">&quot;com&quot;</span>, <span class="string">&quot;rat&quot;</span>): mul_complex_and_rational,</span><br><span class="line">						(<span class="string">&quot;rat&quot;</span>, <span class="string">&quot;com&quot;</span>): mul_rational_and_complex&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="强制类型转换"><a href="#强制类型转换" class="headerlink" title="强制类型转换"></a>强制类型转换</h3><p>将一种数据类型和另一种数据类型在符合某种条件时可以实施强制类型转换来简化操作<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">class</span> <span class="title class_">Number</span>:</span><br><span class="line">		<span class="keyword">def</span> <span class="title function_">__add__</span>(<span class="params">self, other</span>):</span><br><span class="line">			x, y = self.coerce(other)</span><br><span class="line">			<span class="keyword">return</span> x.add(y)</span><br><span class="line">		<span class="keyword">def</span> <span class="title function_">__mul__</span>(<span class="params">self, other</span>):</span><br><span class="line">			x, y = self.coerce(other)</span><br><span class="line">			<span class="keyword">return</span> x.mul(y)</span><br><span class="line">		<span class="keyword">def</span> <span class="title function_">coerce</span>(<span class="params">self, other</span>):</span><br><span class="line">			<span class="keyword">if</span> self.type_tag == other.type_tag:</span><br><span class="line">				<span class="keyword">return</span> self, other</span><br><span class="line">			<span class="keyword">elif</span> (self.type_tag, other.type_tag) <span class="keyword">in</span> self.coercions:</span><br><span class="line">				<span class="keyword">return</span> (self.coerce_to(other.type_tag), other)</span><br><span class="line">			<span class="keyword">elif</span> (other.type_tag, self.type_tag) <span class="keyword">in</span> self.coercions:</span><br><span class="line">				<span class="keyword">return</span> (self, other.coerce_to(self.type_tag))</span><br><span class="line">		<span class="keyword">def</span> <span class="title function_">coerce_to</span>(<span class="params">self, other_tag</span>):</span><br><span class="line">			coercion_fn = self.coercions[(self.type_tag, other_tag)]</span><br><span class="line">			<span class="keyword">return</span> coercion_fn(self)</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">rational_to_complex</span>(<span class="params">r</span>):</span><br><span class="line">		    <span class="keyword">return</span> ComplexRI(r.numer/r.denom, <span class="number">0</span>)</span><br><span class="line">		coercions = &#123;(<span class="string">&#x27;rat&#x27;</span>, <span class="string">&#x27;com&#x27;</span>): rational_to_complex&#125;</span><br><span class="line">        </span><br></pre></td></tr></table></figure></p>
<h2 id="效率"><a href="#效率" class="headerlink" title="效率"></a>效率</h2><p>可以用记忆化来提前存储值：<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">memo</span>(<span class="params">f</span>):</span><br><span class="line">        cache = &#123;&#125;</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">memorized</span>(<span class="params">n</span>):</span><br><span class="line">            <span class="keyword">if</span> n <span class="keyword">not</span> <span class="keyword">in</span> cache:</span><br><span class="line">                cache[n] = f(n)</span><br><span class="line">            <span class="keyword">return</span> cache[n]</span><br><span class="line">        <span class="keyword">return</span> memorized</span><br></pre></td></tr></table></figure></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">count</span>(<span class="params">f</span>):</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">counted</span>(<span class="params">n</span>):</span><br><span class="line">            counted.call_count += <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> f(n)</span><br><span class="line">        counted.call_count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> counted</span><br></pre></td></tr></table></figure>
<p>这种方式可以构造类似于类的属性值，作为外部变量来使用<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>fib = count(fib)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fib(<span class="number">19</span>)</span><br><span class="line"><span class="number">4181</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fib.call_count</span><br><span class="line"><span class="number">10946</span></span><br></pre></td></tr></table></figure></p>
<p>阶乘的时间复杂度 $\Theta(\log_{2}{n})$ 的优化  </p>
<script type="math/tex; mode=display">
b^{n}=\begin{cases}(b^{\frac{n}{2}})^{2}\qquad\qquad 如果n是偶数\\ b\cdot{b^{n-1}}\qquad\quad 如果n是奇数\end{cases}</script><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">square</span>(<span class="params">x</span>):</span><br><span class="line">        <span class="keyword">return</span> x * x</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">fast_exp</span>(<span class="params">b, n</span>):</span><br><span class="line">        <span class="keyword">if</span> n == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> n % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> square(fast_exp(b, n // <span class="number">2</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> b * fast_exp(b, n - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fast_exp(<span class="number">2</span>, <span class="number">100</span>)</span><br><span class="line"><span class="number">1267650600228229401496703205376</span></span><br></pre></td></tr></table></figure>
<p>python中的<code>if in</code>是有n的时间复杂度的</p>
<p>feibonaqi数列最接近黄金比例的n-2次方除以根号5</p>
<h2 id="递归对象"><a href="#递归对象" class="headerlink" title="递归对象"></a>递归对象</h2><p>可以使用类方法的递归来构建诸如<strong>链表、树、集合</strong>的数据结构，以及<strong>add、repr</strong>等方法，和很多操作，其本质和递归函数是一样的，可以用<code>Link.__add__ = extend</code>来直接进行专用方法赋值，具体方法如下：</p>
<p>链表<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">class</span> <span class="title class_">Link</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;一个链表&quot;&quot;&quot;</span></span><br><span class="line">        empty = ()</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, first, rest=(<span class="params"></span>)</span>):</span><br><span class="line">            <span class="keyword">assert</span> rest == Link.empty <span class="keyword">or</span> <span class="built_in">isinstance</span>(rest, Link)</span><br><span class="line">            self.first = first</span><br><span class="line">            self.rest = rest</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, i</span>):</span><br><span class="line">            <span class="keyword">if</span> i == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">return</span> self.first</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> self.rest[i-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span> + <span class="built_in">len</span>(self.rest)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = Link(<span class="number">3</span>, Link(<span class="number">4</span>, Link(<span class="number">5</span>)))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(s)</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s[<span class="number">1</span>]</span><br><span class="line"><span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">link_expression</span>(<span class="params">s</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;返回一个可以计算得到 s 的字符串表达式。&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> s.rest <span class="keyword">is</span> Link.empty:</span><br><span class="line">            rest = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            rest = <span class="string">&#x27;, &#x27;</span> + link_expression(s.rest)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Link(&#123;0&#125;&#123;1&#125;)&#x27;</span>.<span class="built_in">format</span>(s.first, rest)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>link_expression(s)</span><br><span class="line"><span class="string">&#x27;Link(3, Link(4, Link(5)))&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Link.__repr__ = link_expression</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line">Link(<span class="number">3</span>, Link(<span class="number">4</span>, Link(<span class="number">5</span>)))</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s_first = Link(s, Link(<span class="number">6</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s_first</span><br><span class="line">Link(Link(<span class="number">3</span>, Link(<span class="number">4</span>, Link(<span class="number">5</span>))), Link(<span class="number">6</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(s_first)</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(s_first[<span class="number">0</span>])</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s_first[<span class="number">0</span>][<span class="number">2</span>]</span><br><span class="line"><span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">extend_link</span>(<span class="params">s, t</span>):</span><br><span class="line">        <span class="keyword">if</span> s <span class="keyword">is</span> Link.empty:</span><br><span class="line">            <span class="keyword">return</span> t</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> Link(s.first, extend_link(s.rest, t))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>extend_link(s, s)</span><br><span class="line">Link(<span class="number">3</span>, Link(<span class="number">4</span>, Link(<span class="number">5</span>, Link(<span class="number">3</span>, Link(<span class="number">4</span>, Link(<span class="number">5</span>))))))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Link.__add__ = extend_link</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s + s</span><br><span class="line">Link(<span class="number">3</span>, Link(<span class="number">4</span>, Link(<span class="number">5</span>, Link(<span class="number">3</span>, Link(<span class="number">4</span>, Link(<span class="number">5</span>))))))</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">map_link</span>(<span class="params">f, s</span>):</span><br><span class="line">        <span class="keyword">if</span> s <span class="keyword">is</span> Link.empty:</span><br><span class="line">            <span class="keyword">return</span> s</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> Link(f(s.first), map_link(f, s.rest))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>map_link(square, s)</span><br><span class="line">Link(<span class="number">9</span>, Link(<span class="number">16</span>, Link(<span class="number">25</span>)))</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">filter_link</span>(<span class="params">f, s</span>):</span><br><span class="line">        <span class="keyword">if</span> s <span class="keyword">is</span> Link.empty:</span><br><span class="line">            <span class="keyword">return</span> s</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            filtered = filter_link(f, s.rest)</span><br><span class="line">            <span class="keyword">if</span> f(s.first):</span><br><span class="line">                <span class="keyword">return</span> Link(s.first, filtered)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> filtered</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>odd = <span class="keyword">lambda</span> x: x % <span class="number">2</span> == <span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>map_link(square, filter_link(odd, s))</span><br><span class="line">Link(<span class="number">9</span>, Link(<span class="number">25</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[square(x) <span class="keyword">for</span> x <span class="keyword">in</span> [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>] <span class="keyword">if</span> odd(x)]</span><br><span class="line">[<span class="number">9</span>, <span class="number">25</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">join_link</span>(<span class="params">s, separator</span>):</span><br><span class="line">        <span class="keyword">if</span> s <span class="keyword">is</span> Link.empty:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">elif</span> s.rest <span class="keyword">is</span> Link.empty:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">str</span>(s.first)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">str</span>(s.first) + separator + join_link(s.rest, separator)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>join_link(s, <span class="string">&quot;, &quot;</span>)</span><br><span class="line"><span class="string">&#x27;3, 4, 5&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">partitions</span>(<span class="params">n, m</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Return a linked list of partitions of n using parts of up to m.</span></span><br><span class="line"><span class="string">        Each partition is represented as a linked list.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> n == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> Link(Link.empty) <span class="comment"># A list containing the empty partition</span></span><br><span class="line">        <span class="keyword">elif</span> n &lt; <span class="number">0</span> <span class="keyword">or</span> m == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> Link.empty</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            using_m = partitions(n-m, m)</span><br><span class="line">            with_m = map_link(<span class="keyword">lambda</span> s: Link(m, s), using_m)</span><br><span class="line">            without_m = partitions(n, m-<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> with_m + without_m</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">print_partitions</span>(<span class="params">n, m</span>):</span><br><span class="line">        lists = partitions(n, m)</span><br><span class="line">        strings = map_link(<span class="keyword">lambda</span> s: join_link(s, <span class="string">&quot; + &quot;</span>), lists)</span><br><span class="line">        <span class="built_in">print</span>(join_link(strings, <span class="string">&quot;\n&quot;</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print_partitions(<span class="number">6</span>, <span class="number">4</span>)</span><br><span class="line"><span class="number">4</span> + <span class="number">2</span></span><br><span class="line"><span class="number">4</span> + <span class="number">1</span> + <span class="number">1</span></span><br><span class="line"><span class="number">3</span> + <span class="number">3</span></span><br><span class="line"><span class="number">3</span> + <span class="number">2</span> + <span class="number">1</span></span><br><span class="line"><span class="number">3</span> + <span class="number">1</span> + <span class="number">1</span> + <span class="number">1</span></span><br><span class="line"><span class="number">2</span> + <span class="number">2</span> + <span class="number">2</span></span><br><span class="line"><span class="number">2</span> + <span class="number">2</span> + <span class="number">1</span> + <span class="number">1</span></span><br><span class="line"><span class="number">2</span> + <span class="number">1</span> + <span class="number">1</span> + <span class="number">1</span> + <span class="number">1</span></span><br><span class="line"><span class="number">1</span> + <span class="number">1</span> + <span class="number">1</span> + <span class="number">1</span> + <span class="number">1</span> + <span class="number">1</span></span><br></pre></td></tr></table></figure></p>
<p>树：<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">class</span> <span class="title class_">Tree</span>:</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, label, branches=(<span class="params"></span>)</span>):</span><br><span class="line">            self.label = label</span><br><span class="line">            <span class="keyword">for</span> branch <span class="keyword">in</span> branches:</span><br><span class="line">                <span class="keyword">assert</span> <span class="built_in">isinstance</span>(branch, Tree)</span><br><span class="line">            self.branches = branches</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">            <span class="keyword">if</span> self.branches:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;Tree(&#123;0&#125;, &#123;1&#125;)&#x27;</span>.<span class="built_in">format</span>(self.label, <span class="built_in">repr</span>(self.branches))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;Tree(&#123;0&#125;)&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">repr</span>(self.label))</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">is_leaf</span>(<span class="params">self</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">not</span> self.branches</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">fib_tree</span>(<span class="params">n</span>):</span><br><span class="line">        <span class="keyword">if</span> n == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> Tree(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">elif</span> n == <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">return</span> Tree(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            left = fib_tree(n-<span class="number">2</span>)</span><br><span class="line">            right = fib_tree(n-<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> Tree(left.label + right.label, (left, right))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fib_tree(<span class="number">5</span>)</span><br><span class="line">Tree(<span class="number">3</span>, (Tree(<span class="number">1</span>, (Tree(<span class="number">0</span>), Tree(<span class="number">1</span>))), Tree(<span class="number">2</span>, (Tree(<span class="number">1</span>), Tree(<span class="number">1</span>, (Tree(<span class="number">0</span>), Tree(<span class="number">1</span>)))))))</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">sum_labels</span>(<span class="params">t</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;对树的 label 求和，可能得到 None。&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> t.label + <span class="built_in">sum</span>([sum_labels(b) <span class="keyword">for</span> b <span class="keyword">in</span> t.branches])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sum_labels(fib_tree(<span class="number">5</span>))</span><br><span class="line"><span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fib_tree = memo(fib_tree)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>big_fib_tree = fib_tree(<span class="number">35</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>big_fib_tree.label</span><br><span class="line"><span class="number">5702887</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>big_fib_tree.branches[<span class="number">0</span>] <span class="keyword">is</span> big_fib_tree.branches[<span class="number">1</span>].branches[<span class="number">1</span>]</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sum_labels = memo(sum_labels)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sum_labels(big_fib_tree)</span><br><span class="line"><span class="number">142587180</span></span><br></pre></td></tr></table></figure></p>
<p>集合：<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">3</span> <span class="keyword">in</span> s</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(s)</span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.union(&#123;<span class="number">1</span>, <span class="number">5</span>&#125;)</span><br><span class="line">&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.intersection(&#123;<span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>&#125;)</span><br><span class="line">&#123;<span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">empty</span>(<span class="params">s</span>):</span><br><span class="line">        <span class="keyword">return</span> s <span class="keyword">is</span> Link.empty</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">set_contains</span>(<span class="params">s, v</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;当且仅当 set s 包含 v 时返回 True。&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> empty(s):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">elif</span> s.first == v:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> set_contains(s.rest, v)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = Link(<span class="number">4</span>, Link(<span class="number">1</span>, Link(<span class="number">5</span>)))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>set_contains(s, <span class="number">2</span>)</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>set_contains(s, <span class="number">5</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">adjoin_set</span>(<span class="params">s, v</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;返回一个包含 s 的所有元素和元素 v 的所有元素的集合。&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> set_contains(s, v):</span><br><span class="line">            <span class="keyword">return</span> s</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> Link(v, s)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = adjoin_set(s, <span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t</span><br><span class="line">Link(<span class="number">2</span>, Link(<span class="number">4</span>, Link(<span class="number">1</span>, Link(<span class="number">5</span>))))</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">union_set</span>(<span class="params">set1, set2</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;返回一个集合，包含 set1 和 set2 中的所有元素。&quot;&quot;&quot;</span></span><br><span class="line">        set1_not_set2 = keep_if_link(set1, <span class="keyword">lambda</span> v: <span class="keyword">not</span> set_contains(set2, v))</span><br><span class="line">        <span class="keyword">return</span> extend_link(set1_not_set2, set2)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>union_set(t, s)</span><br><span class="line">Link(<span class="number">2</span>, Link(<span class="number">4</span>, Link(<span class="number">1</span>, Link(<span class="number">5</span>))))</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">set_contains</span>(<span class="params">s, v</span>):</span><br><span class="line">        <span class="keyword">if</span> empty(s) <span class="keyword">or</span> s.first &gt; v:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">elif</span> s.first == v:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> set_contains(s.rest, v)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>u = Link(<span class="number">1</span>, Link(<span class="number">4</span>, Link(<span class="number">5</span>)))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>set_contains(u, <span class="number">0</span>)</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>set_contains(u, <span class="number">4</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">intersect_set</span>(<span class="params">set1, set2</span>):</span><br><span class="line">        <span class="keyword">if</span> empty(set1) <span class="keyword">or</span> empty(set2):</span><br><span class="line">            <span class="keyword">return</span> Link.empty</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            e1, e2 = set1.first, set2.first</span><br><span class="line">            <span class="keyword">if</span> e1 == e2:</span><br><span class="line">                <span class="keyword">return</span> Link(e1, intersect_set(set1.rest, set2.rest))</span><br><span class="line">            <span class="keyword">elif</span> e1 &lt; e2:</span><br><span class="line">                <span class="keyword">return</span> intersect_set(set1.rest, set2)</span><br><span class="line">            <span class="keyword">elif</span> e2 &lt; e1:</span><br><span class="line">                <span class="keyword">return</span> intersect_set(set1, set2.rest)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>intersect_set(s, s.rest)</span><br><span class="line">Link(<span class="number">4</span>, Link(<span class="number">5</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">set_contains</span>(<span class="params">s, v</span>):</span><br><span class="line">        <span class="keyword">if</span> s <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">elif</span> s.entry == v:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">elif</span> s.entry &lt; v:</span><br><span class="line">            <span class="keyword">return</span> set_contains(s.right, v)</span><br><span class="line">        <span class="keyword">elif</span> s.entry &gt; v:</span><br><span class="line">            <span class="keyword">return</span> set_contains(s.left, v)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">adjoin_set</span>(<span class="params">s, v</span>):</span><br><span class="line">        <span class="keyword">if</span> s <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> Tree(v)</span><br><span class="line">        <span class="keyword">elif</span> s.entry == v:</span><br><span class="line">            <span class="keyword">return</span> s</span><br><span class="line">        <span class="keyword">elif</span> s.entry &lt; v:</span><br><span class="line">            <span class="keyword">return</span> Tree(s.entry, s.left, adjoin_set(s.right, v))</span><br><span class="line">        <span class="keyword">elif</span> s.entry &gt; v:</span><br><span class="line">            <span class="keyword">return</span> Tree(s.entry, adjoin_set(s.left, v), s.right)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>adjoin_set(adjoin_set(adjoin_set(<span class="literal">None</span>, <span class="number">2</span>), <span class="number">3</span>), <span class="number">1</span>)</span><br><span class="line">Tree(<span class="number">2</span>, Tree(<span class="number">1</span>), Tree(<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<h2 id="迭代器"><a href="#迭代器" class="headerlink" title="迭代器"></a>迭代器</h2><p>为了不预先存储值，但是能动态生成所要的数据或者操作，使用惰态计算，给予时延<br>iterator使用next返回下一个值，当没有值时返回StopIteration<br>迭代器用iter构造可迭代对象为迭代器，iter本身也可以被使用iter方法，作用是绑定名称        </p>
<p>map 函数是惰性的：调用它时并不会执行计算，直到返回的迭代器被 next 调用<br>相反，会创建一个迭代器对象，如果使用 next 查询， 该迭代器对象可以返回结果。我们可以在下面的示例中观察到这一事实，其中对 print 的调用被 延迟，直到从 doubled 迭代器请求相应的元素为止。<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">double_and_print</span>(<span class="params">x</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;***&#x27;</span>, x, <span class="string">&#x27;=&gt;&#x27;</span>, <span class="number">2</span>*x, <span class="string">&#x27;***&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span>*x</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="built_in">range</span>(<span class="number">3</span>, <span class="number">7</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>doubled = <span class="built_in">map</span>(double_and_print, s)  <span class="comment"># double_and_print 未被调用</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(doubled)                       <span class="comment"># double_and_print 调用一次</span></span><br><span class="line">*** <span class="number">3</span> =&gt; <span class="number">6</span> ***</span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(doubled)                       <span class="comment"># double_and_print 再次调用</span></span><br><span class="line">*** <span class="number">4</span> =&gt; <span class="number">8</span> ***</span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">list</span>(doubled)                       <span class="comment"># double_and_print 再次调用兩次</span></span><br><span class="line">*** <span class="number">5</span> =&gt; <span class="number">10</span> ***                         <span class="comment"># list() 会把剩余的值都计算出来并生成一个列表</span></span><br><span class="line">*** <span class="number">6</span> =&gt; <span class="number">12</span> ***</span><br><span class="line">[<span class="number">10</span>, <span class="number">12</span>]</span><br></pre></td></tr></table></figure><br>filter 函数返回一个迭代器， zip 和 reversed 函数也返回迭代器。  </p>
<p>for循环是调用了可迭代对象本身的<strong>iter</strong>方法，返回next值给绑定值，然后执行\<suite>主体部分<br>构造for循环：<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>items = counts.__iter__()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">             item = items.__next__()</span><br><span class="line">             <span class="built_in">print</span>(item)</span><br><span class="line">    <span class="keyword">except</span> StopIteration:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure></suite></p>
<h3 id="生成器"><a href="#生成器" class="headerlink" title="生成器"></a>生成器</h3><p>生成器是一种迭代器，为了控制迭代函数的进度，使用生成器，关键词为yield，当函数内有yield关键词时，默认返回一个生成器，每次next返回下一个yield对应的值</p>
<h3 id="可迭代接口"><a href="#可迭代接口" class="headerlink" title="可迭代接口"></a>可迭代接口</h3><p>可以使类的<strong>iter</strong>方法返回一个迭代器，但是类本身是不变的<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">class</span> <span class="title class_">Letters</span>:</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, start=<span class="string">&#x27;a&#x27;</span>, end=<span class="string">&#x27;e&#x27;</span></span>):</span><br><span class="line">            self.start = start</span><br><span class="line">            self.end = end</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">            <span class="keyword">return</span> LetterIter(self.start, self.end)</span><br></pre></td></tr></table></figure></p>
<p>自定义迭代器，next方法，使用next时调用：<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">class</span> <span class="title class_">LetterIter</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;依照 ASCII 码值顺序迭代字符的迭代器。&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, start=<span class="string">&#x27;a&#x27;</span>, end=<span class="string">&#x27;e&#x27;</span></span>):</span><br><span class="line">            self.next_letter = start</span><br><span class="line">            self.end = end</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__next__</span>(<span class="params">self</span>):</span><br><span class="line">            <span class="keyword">if</span> self.next_letter == self.end:</span><br><span class="line">                <span class="keyword">raise</span> StopIteration</span><br><span class="line">            letter = self.next_letter</span><br><span class="line">            self.next_letter = <span class="built_in">chr</span>(<span class="built_in">ord</span>(letter)+<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> letter</span><br></pre></td></tr></table></figure></p>
<h3 id="流：惰性递归"><a href="#流：惰性递归" class="headerlink" title="流：惰性递归"></a>流：惰性递归</h3><p>Stream是一种对递归使用惰性的方法，不会提前计算下一个递归结果是什么，除非手动调用它<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = Stream(<span class="number">1</span>, <span class="keyword">lambda</span>: Stream(<span class="number">2</span>+<span class="number">3</span>, <span class="keyword">lambda</span>: Stream.empty))</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">class</span> <span class="title class_">Stream</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;A lazily computed recursive list.&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, first, compute_rest, empty=<span class="literal">False</span></span>):</span><br><span class="line">            self.first = first</span><br><span class="line">            self._compute_rest = compute_rest</span><br><span class="line">            self.empty = empty</span><br><span class="line">            self._rest = <span class="literal">None</span></span><br><span class="line">            self._computed = <span class="literal">False</span></span><br><span class="line"><span class="meta">        @property</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">rest</span>(<span class="params">self</span>):</span><br><span class="line">            <span class="string">&quot;&quot;&quot;Return the rest of the stream, computing it if necessary.&quot;&quot;&quot;</span></span><br><span class="line">            <span class="keyword">assert</span> <span class="keyword">not</span> self.empty, <span class="string">&#x27;Empty streams have no rest.&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self._computed:</span><br><span class="line">                self._rest = self._compute_rest()</span><br><span class="line">                self._computed = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">return</span> self._rest</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">            <span class="keyword">if</span> self.empty:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;&lt;empty stream&gt;&#x27;</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;Stream(&#123;0&#125;, &lt;compute_rest&gt;)&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">repr</span>(self.first))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Stream.empty = Stream(<span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">True</span>)</span><br></pre></td></tr></table></figure></p>
<p>可以修改定义map函数或者filter函数，使map功能可以给流的每个递归<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">map_stream</span>(<span class="params">fn, s</span>):</span><br><span class="line">        <span class="keyword">if</span> s.empty:</span><br><span class="line">            <span class="keyword">return</span> s</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">compute_rest</span>():</span><br><span class="line">            <span class="keyword">return</span> map_stream(fn, s.rest)</span><br><span class="line">        <span class="keyword">return</span> Stream(fn(s.first), compute_rest)</span><br></pre></td></tr></table></figure></p>
<h2 id="Scheme"><a href="#Scheme" class="headerlink" title="Scheme"></a>Scheme</h2><p>compiler编译器：编译为底层语言供机器识别<br>interpreter解释器：将一种语言解释为另一种语言，python的解释器就是用c写的，因为解释器是按照每一行来读取输入的，所以解释器是行解释的  </p>
<p>对一个语言的解释：</p>
<ul>
<li>词法解析(lexical analyzer)：使用分词器将语法分为标记(token)，之后传给语法解析器</li>
<li>语法解析(syntactic analyzer)：对标记使用可递归的数据结构来构架语法树</li>
<li>计算(calculate)：对语法树进行计算，计算面向的是递归的数据结构</li>
</ul>
<h2 id="语法杂记"><a href="#语法杂记" class="headerlink" title="语法杂记"></a>语法杂记</h2><p>定义函数参数给出后视作默认值，使用时可以不写</p>
<p>文档字符串，三个双引号，使用help(fun)查看</p>
<p>元组的加与乘返回结果是组合以后的元组，map函数可将函数应用于数据，reduce可以将函数作用于序列返回单值(归约)，tuple可以将数据类型变为元组</p>
<p>python对变量的定义是非严格的，所以想要在函数内使用父帧的变量要进行声明，否则默认为局部帧的新变量<br>声明方法有<code>nonlocal</code>(嵌套函数)和<code>global</code>(全局)</p>
<p>is和is not用于判断两个对像是否相同，这个相同指的是相同的内存地址</p>
<p>强制类型转换，类型不加括号</p>
<p>print(‘a’),打印：a</p>
<p>and运算时，从左到右演算表达式的值。0, ‘’, [], {}, None在布尔表达式环境下为假，其他任何东西都为真，返回作后一个真值或假值<br>or返回最后一个真值或最后一个假值<br>not 10 返回False， not None 返回True   注意0是真值,但是not 0中0为假<br>1/0 or True 为Error，从左到右判断，遇到Error直接Error</p>
<p>元组元素不可修改</p>
<p>assert用法：<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span> <span class="built_in">type</span>(sides) == <span class="built_in">int</span> <span class="keyword">and</span> sides &gt;= <span class="number">1</span>, <span class="string">&#x27;Illegal value for sides&#x27;</span> </span><br></pre></td></tr></table></figure></p>
<p>return A if condition else </p>
<p>.strip()方法消除字符串首尾空白字符</p>
<p>字典中的in是判断的key值</p>
<p>random.sample接受list和指定个数，返回列表   一定要注意函数的返回类型</p>
<p>列表和字符串[1:]没有的时候会返回空，不会报错</p>
<p>字典可以多对一</p>
<p>for 迭代变量会自动修正</p>
<p>del删除列表元素</p>
<p>生成迭代器：iter()， 下一个next()，对应类的<strong>iter</strong>和<strong>next</strong>方法，迭代器的一个好处是不会和列表一样占用内存空间</p>
<p>生成器：是一种返回一个值的迭代器，使用yield产生<br>有next方法，send方法<br>生成器函数的调用会返回一个生成器(就像是类和实例)，生成器也就是迭代器，好处是可以暂存挂起当前状态，来节省状态<br>生成器中的return被调用时会抛出报错，当函数中含有yield关键词的时候，这个函数就已经是一个用来返回生成器的道具了，不是一般的函数  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="built_in">type</span>([i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)])     <span class="comment">#推导式</span></span><br><span class="line">Out[<span class="number">1</span>]: <span class="built_in">list</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">2</span>]: <span class="built_in">type</span>((i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)))     <span class="comment">#生成器</span></span><br><span class="line">Out[<span class="number">2</span>]: generator</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>常见的使用生成器来实现的斐波那契数列<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/python</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-*- coding: UTF-8 -*-</span></span><br><span class="line"> </span><br><span class="line">def fab(max): </span><br><span class="line">    n, a, b = 0, 0, 1 </span><br><span class="line">    while n &lt; max: </span><br><span class="line">        yield b      # 使用 yield</span><br><span class="line">        # print b </span><br><span class="line">        a, b = b, a + b </span><br><span class="line">        n = n + 1</span><br><span class="line"> </span><br><span class="line">for n in fab(5): </span><br><span class="line">    print n</span><br></pre></td></tr></table></figure></p>
<p>可以用send方法来发送yield的赋值对象，直接赋值会是None，因为从yield处继续开始迭代，所以不会有值<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">def</span> <span class="title function_">fun</span>():</span><br><span class="line">   ...:     <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">   ...:         <span class="built_in">print</span>(<span class="string">&quot;Start...&quot;</span>)</span><br><span class="line">   ...:         receive =  <span class="keyword">yield</span> i</span><br><span class="line">   ...:         <span class="built_in">print</span>(receive)</span><br><span class="line">   ...:</span><br><span class="line"></span><br><span class="line">In [<span class="number">2</span>]: f = fun()</span><br><span class="line"></span><br><span class="line">In [<span class="number">3</span>]: <span class="built_in">next</span>(f)</span><br><span class="line">Start...</span><br><span class="line">Out[<span class="number">3</span>]: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">4</span>]: <span class="built_in">next</span>(f)</span><br><span class="line"><span class="literal">None</span></span><br><span class="line">Start...</span><br><span class="line">Out[<span class="number">4</span>]: <span class="number">1</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">5</span>]: <span class="built_in">next</span>(f)</span><br><span class="line"><span class="literal">None</span></span><br><span class="line">Start...</span><br><span class="line">Out[<span class="number">5</span>]: <span class="number">2</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">6</span>]: f.send(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line">hello</span><br><span class="line">Start...</span><br><span class="line">Out[<span class="number">6</span>]: <span class="number">3</span></span><br></pre></td></tr></table></figure></p>
<p>对iter调用iter，是同一个迭代器<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line">t = <span class="built_in">iter</span>(s)</span><br><span class="line">q = <span class="built_in">iter</span>(t)</span><br></pre></td></tr></table></figure></p>
<p>close方法可以关闭生成器</p>
<p>无穷：value = float(‘inf’)</p>
<p>zip函数：返回可迭代对象元素组成的元组的列表<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ls = <span class="built_in">zip</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>], [<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ls</span><br><span class="line">&lt;<span class="built_in">zip</span> <span class="built_in">object</span> at <span class="number">0x7f47f15ef040</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">list</span>(ls)</span><br><span class="line">[(<span class="number">1</span>, <span class="number">4</span>), (<span class="number">2</span>, <span class="number">5</span>), (<span class="number">3</span>, <span class="number">6</span>)]</span><br></pre></td></tr></table></figure></p>
<h2 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">path_yielder</span>(<span class="params">t, value</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Yields all possible paths from the root of t to a node with the label value</span></span><br><span class="line"><span class="string">    as a list.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; t1 = Tree(1, [Tree(2, [Tree(3), Tree(4, [Tree(6)]), Tree(5)]), Tree(5)])</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; print(t1)</span></span><br><span class="line"><span class="string">    1</span></span><br><span class="line"><span class="string">      2</span></span><br><span class="line"><span class="string">        3</span></span><br><span class="line"><span class="string">        4</span></span><br><span class="line"><span class="string">          6</span></span><br><span class="line"><span class="string">        5</span></span><br><span class="line"><span class="string">      5</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; next(path_yielder(t1, 6))</span></span><br><span class="line"><span class="string">    [1, 2, 4, 6]</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; path_to_5 = path_yielder(t1, 5)</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; sorted(list(path_to_5))</span></span><br><span class="line"><span class="string">    [[1, 2, 5], [1, 5]]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; t2 = Tree(0, [Tree(2, [t1])])</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; print(t2)</span></span><br><span class="line"><span class="string">    0</span></span><br><span class="line"><span class="string">      2</span></span><br><span class="line"><span class="string">        1</span></span><br><span class="line"><span class="string">          2</span></span><br><span class="line"><span class="string">            3</span></span><br><span class="line"><span class="string">            4</span></span><br><span class="line"><span class="string">              6</span></span><br><span class="line"><span class="string">            5</span></span><br><span class="line"><span class="string">          5</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; path_to_2 = path_yielder(t2, 2)</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; sorted(list(path_to_2))</span></span><br><span class="line"><span class="string">    [[0, 2], [0, 2, 1, 2]]</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">## 递归的信仰之越，无关返回类型，只关心现在的判断和下一个关系</span></span><br><span class="line">    <span class="comment">## 生成器遇到return，会停止这一项的yield，但是不会返回值，这题表现为停止一条路径，继续执行下面的yield</span></span><br><span class="line">    <span class="comment">## 因为到叶子节点的时候，path函数是函数，所以返回上一级</span></span><br><span class="line">    <span class="comment">## 抽象思维，先抽象再具象，如果以上来就具象的话会很难完成</span></span><br><span class="line">    <span class="keyword">if</span> t.label == value:</span><br><span class="line">        <span class="keyword">yield</span> [t.label]</span><br><span class="line">    <span class="keyword">elif</span> t.is_leaf():</span><br><span class="line">        <span class="comment">#use return instead of yield! because the road does not exit, so we shouldn&#x27;t yield it</span></span><br><span class="line">        <span class="keyword">return</span> []   </span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> t.branches:</span><br><span class="line">        <span class="keyword">for</span> road <span class="keyword">in</span> path_yielder(b, value):</span><br><span class="line">            <span class="string">&quot;*** YOUR CODE HERE ***&quot;</span></span><br><span class="line">            road.insert(<span class="number">0</span>, t.label)</span><br><span class="line">            <span class="keyword">yield</span> road</span><br></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">remove_all</span>(<span class="params">link , value</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Remove all the nodes containing value in link. Assume that the</span></span><br><span class="line"><span class="string">    first element is never removed.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; l1 = Link(0, Link(2, Link(2, Link(3, Link(1, Link(2, Link(3)))))))</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; print(l1)</span></span><br><span class="line"><span class="string">    &lt;0 2 2 3 1 2 3&gt;</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; remove_all(l1, 2)</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; print(l1)</span></span><br><span class="line"><span class="string">    &lt;0 3 1 3&gt;</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; remove_all(l1, 3)</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; print(l1)</span></span><br><span class="line"><span class="string">    &lt;0 1&gt;</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; remove_all(l1, 3)</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; print(l1)</span></span><br><span class="line"><span class="string">    &lt;0 1&gt;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="string">&quot;*** YOUR CODE HERE ***&quot;</span></span><br><span class="line">    <span class="comment">#?为什么做起来难度这么大，对于递归要清楚函数的功能，先将函数本身的功能定义好</span></span><br><span class="line">    <span class="keyword">if</span> link <span class="keyword">is</span> Link.empty:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> link.rest <span class="keyword">is</span> Link.empty <span class="keyword">and</span> link.rest.first == value:</span><br><span class="line">        link.rest = link.rest.rest</span><br><span class="line">    remove_all(link.rest, value)</span><br></pre></td></tr></table></figure>
<p>scheme尾递归：需要新定义函数<br>要存储功能的话就要将存储表作为参数传</p>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="built_in">define</span></span> (<span class="name">replicate</span> x n)</span><br><span class="line">  <span class="symbol">&#x27;YOUR-CODE-HERE</span></span><br><span class="line">  (<span class="name"><span class="built_in">define</span></span> (<span class="name">repl</span> lst x n)</span><br><span class="line">    (<span class="name"><span class="built_in">if</span></span> (<span class="name"><span class="built_in">=</span></span> n <span class="number">0</span>)</span><br><span class="line">      lst</span><br><span class="line">      (<span class="name">repl</span> (<span class="name"><span class="built_in">cons</span></span> x lst) x (<span class="name"><span class="built_in">-</span></span> n <span class="number">1</span>))))</span><br><span class="line">  (<span class="name">repl</span> nil x n)</span><br><span class="line">  )</span><br></pre></td></tr></table></figure>
<p>又比如：<br><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="built_in">define</span></span> (<span class="name">accumulate</span> combiner start n term)</span><br><span class="line">  <span class="symbol">&#x27;YOUR-CODE-HERE</span></span><br><span class="line">  (<span class="name"><span class="built_in">begin</span></span></span><br><span class="line">    (<span class="name"><span class="built_in">define</span></span> (<span class="name">acc</span> result combiner start n term)</span><br><span class="line">      (<span class="name"><span class="built_in">if</span></span> (<span class="name"><span class="built_in">=</span></span> n <span class="number">0</span>)</span><br><span class="line">        result</span><br><span class="line">        (<span class="name">acc</span> (<span class="name">combiner</span> (<span class="name">term</span> start) result) combiner (<span class="name"><span class="built_in">+</span></span> <span class="number">1</span> start) (<span class="name"><span class="built_in">-</span></span> n <span class="number">1</span>) term)))</span><br><span class="line">    (<span class="name">acc</span> start combiner <span class="number">1</span> n term)</span><br><span class="line">  )</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://marvoalou.github.io">zxman</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://marvoalou.github.io/2024/02/24/CS61A-note/">http://marvoalou.github.io/2024/02/24/CS61A-note/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://marvoalou.github.io" target="_blank">Zxman</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/img/xuezhixia.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2024/02/24/SQL/" title="SQL"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">SQL</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/xuezhixia.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">zxman</div><div class="author-info__description">Hope to enjoy everyday, and find the love i am searchong for</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">8</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/marvoalou"><i class="fab fa-github"></i><span>My Github</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/marvoalou" target="_blank" title="Github"><i class="fab fa-github" style="color: #fffafa;"></i></a><a class="social-icon" href="mailto:zxy799804792@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #fffafa;"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0"><span class="toc-number">1.</span> <span class="toc-text">高阶函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%BD%E8%B1%A1"><span class="toc-number">1.1.</span> <span class="toc-text">抽象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lamda"><span class="toc-number">1.2.</span> <span class="toc-text">lamda</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="toc-number">1.3.</span> <span class="toc-text">装饰器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%AF%E9%87%8C%E5%8C%96"><span class="toc-number">1.4.</span> <span class="toc-text">柯里化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%92%E5%BD%92"><span class="toc-number">1.5.</span> <span class="toc-text">递归</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%8A%BD%E8%B1%A1"><span class="toc-number">2.</span> <span class="toc-text">数据抽象</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%8F%E5%88%97"><span class="toc-number">2.1.</span> <span class="toc-text">序列</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-%E5%8F%AF%E5%8F%98%E6%95%B0%E6%8D%AE"><span class="toc-number">3.</span> <span class="toc-text">2.4 可变数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E8%AE%BE%E8%AE%A1%E7%B1%BB%EF%BC%9F"><span class="toc-number">3.0.1.</span> <span class="toc-text">为什么要设计类？</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%90%86%E8%A7%A3%E6%8A%BD%E8%B1%A1"><span class="toc-number">3.1.</span> <span class="toc-text">理解抽象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%97%E8%A1%A8"><span class="toc-number">3.2.</span> <span class="toc-text">列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%83%E7%BB%84"><span class="toc-number">3.3.</span> <span class="toc-text">元组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E5%85%B8"><span class="toc-number">3.4.</span> <span class="toc-text">字典</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%80%E9%83%A8%E7%8A%B6%E6%80%81"><span class="toc-number">3.5.</span> <span class="toc-text">局部状态</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A5%BD%E5%A4%84"><span class="toc-number">3.5.1.</span> <span class="toc-text">好处</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%88%97%E8%A1%A8%E5%92%8C%E5%AD%97%E5%85%B8%E7%BB%93%E6%9E%84"><span class="toc-number">3.5.2.</span> <span class="toc-text">实现列表和字典结构</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E%E5%BC%8F%E7%BC%96%E7%A8%8B%E5%AE%9E%E8%B7%B5%EF%BC%9A%E7%BA%A6%E6%9D%9F%E4%BC%A0%E9%80%92-Propagating-Constraints"><span class="toc-number">3.6.</span> <span class="toc-text">声明式编程实践：约束传递(Propagating Constraints)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OOP"><span class="toc-number">4.</span> <span class="toc-text">OOP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%87%BD%E6%95%B0%E6%9D%A5%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="toc-number">4.1.</span> <span class="toc-text">使用函数来实现类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%93%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">4.2.</span> <span class="toc-text">专用方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E9%87%8D%E8%A1%A8%E7%A4%BA"><span class="toc-number">4.3.</span> <span class="toc-text">多重表示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%9B%E5%9E%8B%E8%A1%A8%E7%A4%BA"><span class="toc-number">4.4.</span> <span class="toc-text">泛型表示</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E6%B4%BE%E5%8F%91"><span class="toc-number">4.4.1.</span> <span class="toc-text">类型派发</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%BA%E5%88%B6%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="toc-number">4.5.</span> <span class="toc-text">强制类型转换</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%88%E7%8E%87"><span class="toc-number">5.</span> <span class="toc-text">效率</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%92%E5%BD%92%E5%AF%B9%E8%B1%A1"><span class="toc-number">6.</span> <span class="toc-text">递归对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="toc-number">7.</span> <span class="toc-text">迭代器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%99%A8"><span class="toc-number">7.1.</span> <span class="toc-text">生成器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E8%BF%AD%E4%BB%A3%E6%8E%A5%E5%8F%A3"><span class="toc-number">7.2.</span> <span class="toc-text">可迭代接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%EF%BC%9A%E6%83%B0%E6%80%A7%E9%80%92%E5%BD%92"><span class="toc-number">7.3.</span> <span class="toc-text">流：惰性递归</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Scheme"><span class="toc-number">8.</span> <span class="toc-text">Scheme</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95%E6%9D%82%E8%AE%B0"><span class="toc-number">9.</span> <span class="toc-text">语法杂记</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BE%8B%E9%A2%98"><span class="toc-number">10.</span> <span class="toc-text">例题</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/02/24/linux-base/" title="linux_base">linux_base</a><time datetime="2024-02-24T09:22:22.000Z" title="发表于 2024-02-24 17:22:22">2024-02-24</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/02/24/ml/" title="ml">ml</a><time datetime="2024-02-24T09:20:13.000Z" title="发表于 2024-02-24 17:20:13">2024-02-24</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/02/24/math/" title="math">math</a><time datetime="2024-02-24T09:20:07.000Z" title="发表于 2024-02-24 17:20:07">2024-02-24</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/02/24/database/" title="database">database</a><time datetime="2024-02-24T09:17:31.000Z" title="发表于 2024-02-24 17:17:31">2024-02-24</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/02/24/OS-01/" title="OS-01">OS-01</a><time datetime="2024-02-24T09:17:06.000Z" title="发表于 2024-02-24 17:17:06">2024-02-24</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/index1.png')"><div id="footer-wrap"><div class="copyright">&copy;2024 By zxman</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.12.0"></script><script src="/js/main.js?v=4.12.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.32/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.12.0"></script></div></div></body></html>